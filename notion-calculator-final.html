<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>노션 계산기</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            width: 100%;
            height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: #fffafb;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .calc {
            width: 100%;
            height: 100%;
            max-width: min(400px, 100vh);
            max-height: min(600px, 100vh);
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .screen {
            background: #ffecef;
            border-radius: 12px;
            padding: 15px 20px;
            flex: 0 0 80px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .expr {
            font-size: 14px;
            color: #999;
            text-align: right;
            height: 25px;
        }

        .val {
            font-size: 32px;
            color: #333;
            font-weight: bold;
            text-align: right;
            height: 40px;
            overflow: hidden;
        }

        .keys {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 8px;
        }

        .key {
            border: none;
            border-radius: 10px;
            font-size: 20px;
            font-weight: 600;
            cursor: pointer;
            background: #ffecef;
            color: #333;
            box-shadow: 0 3px 0 #fee1e5;
            transition: all 0.1s;
        }

        .key:active {
            transform: translateY(3px);
            box-shadow: none;
        }

        .key.num {
            background: white;
            box-shadow: 0 3px 0 #e0e0e0;
        }

        .key.num:active {
            background: #f5f5f5;
        }

        .key.op {
            color: #ff6b6b;
        }

        .key.clr {
            color: #ff4757;
        }

        .key.eq {
            background: #ff6b6b;
            color: white;
            box-shadow: 0 3px 0 #ff5252;
        }

        .key.eq:active {
            background: #ff5252;
        }

        /* 반응형 - 높이 기반 */
        @media (max-height: 500px) {
            .calc {
                padding: 5px;
                gap: 5px;
            }
            .screen {
                flex: 0 0 60px;
                padding: 10px 15px;
            }
            .expr {
                font-size: 12px;
                height: 20px;
            }
            .val {
                font-size: 24px;
                height: 30px;
            }
            .keys {
                gap: 5px;
            }
            .key {
                font-size: 16px;
                border-radius: 8px;
            }
        }

        @media (max-height: 400px) {
            .calc {
                padding: 3px;
                gap: 3px;
            }
            .screen {
                flex: 0 0 50px;
                padding: 8px 12px;
                border-radius: 8px;
            }
            .expr {
                font-size: 10px;
                height: 18px;
            }
            .val {
                font-size: 20px;
                height: 25px;
            }
            .keys {
                gap: 3px;
            }
            .key {
                font-size: 14px;
                border-radius: 6px;
            }
        }

        @media (max-height: 300px) {
            .screen {
                flex: 0 0 40px;
                padding: 5px 10px;
            }
            .expr {
                font-size: 9px;
                height: 15px;
            }
            .val {
                font-size: 16px;
                height: 20px;
            }
            .key {
                font-size: 12px;
                border-radius: 4px;
            }
        }

        /* 반응형 - 너비 기반 */
        @media (max-width: 350px) {
            .calc {
                padding: 5px;
            }
            .keys {
                gap: 5px;
            }
            .key {
                font-size: 16px;
            }
        }

        /* 비율 기반 조정 */
        @media (aspect-ratio < 1/2) {
            /* 매우 세로가 긴 화면 */
            .screen {
                flex: 0 0 10%;
            }
        }

        @media (aspect-ratio > 2/1) {
            /* 매우 가로가 긴 화면 */
            .calc {
                max-width: 50vh;
            }
        }
    </style>
</head>
<body>
    <div class="calc">
        <div class="screen">
            <div class="expr" id="e"></div>
            <div class="val" id="v">0</div>
        </div>
        <div class="keys">
            <button class="key op" onclick="per()">%</button>
            <button class="key" onclick="ce()">CE</button>
            <button class="key clr" onclick="ac()">C</button>
            <button class="key op" onclick="op('÷')">÷</button>
            
            <button class="key num" onclick="n('7')">7</button>
            <button class="key num" onclick="n('8')">8</button>
            <button class="key num" onclick="n('9')">9</button>
            <button class="key op" onclick="op('×')">×</button>
            
            <button class="key num" onclick="n('4')">4</button>
            <button class="key num" onclick="n('5')">5</button>
            <button class="key num" onclick="n('6')">6</button>
            <button class="key op" onclick="op('-')">-</button>
            
            <button class="key num" onclick="n('1')">1</button>
            <button class="key num" onclick="n('2')">2</button>
            <button class="key num" onclick="n('3')">3</button>
            <button class="key op" onclick="op('+')">+</button>
            
            <button class="key num" onclick="dot()">.</button>
            <button class="key num" onclick="n('0')">0</button>
            <button class="key num" onclick="del()">⌫</button>
            <button class="key eq" onclick="eq()">=</button>
        </div>
    </div>

    <script>
        let cur = '0', prev = '', oper = '', newNum = true;
        const vEl = document.getElementById('v');
        const eEl = document.getElementById('e');

        function upd() {
            vEl.textContent = cur;
            eEl.textContent = prev + (oper ? ' ' + oper : '');
        }

        function ac() {
            cur = '0';
            prev = '';
            oper = '';
            newNum = true;
            upd();
        }

        function ce() {
            cur = '0';
            newNum = true;
            upd();
        }

        function del() {
            if (cur.length > 1) {
                cur = cur.slice(0, -1);
            } else {
                cur = '0';
            }
            upd();
        }

        function n(num) {
            if (newNum || cur === '0') {
                cur = num;
                newNum = false;
            } else if (cur.length < 12) {
                cur += num;
            }
            upd();
        }

        function dot() {
            if (newNum) {
                cur = '0.';
                newNum = false;
            } else if (!cur.includes('.')) {
                cur += '.';
            }
            upd();
        }

        function op(o) {
            if (oper && !newNum) {
                eq();
            }
            prev = cur;
            oper = o;
            newNum = true;
            upd();
        }

        function eq() {
            if (!oper || !prev) return;
            
            const p = parseFloat(prev);
            const c = parseFloat(cur);
            let res;
            
            switch(oper) {
                case '+': res = p + c; break;
                case '-': res = p - c; break;
                case '×': res = p * c; break;
                case '÷': res = c !== 0 ? p / c : 'Error'; break;
            }
            
            cur = res === 'Error' ? 'Error' : res.toString();
            prev = '';
            oper = '';
            newNum = true;
            upd();
        }

        function per() {
            cur = (parseFloat(cur) / 100).toString();
            upd();
        }

        document.addEventListener('keydown', (e) => {
            if (e.key >= '0' && e.key <= '9') n(e.key);
            else if (e.key === '.') dot();
            else if (e.key === '+') op('+');
            else if (e.key === '-') op('-');
            else if (e.key === '*') op('×');
            else if (e.key === '/') op('÷');
            else if (e.key === 'Enter' || e.key === '=') eq();
            else if (e.key === 'Escape') ac();
            else if (e.key === 'Backspace') del();
            else if (e.key === '%') per();
        });

        // 동적 크기 조절
        function adjustSize() {
            const height = window.innerHeight;
            const width = window.innerWidth;
            const calc = document.querySelector('.calc');
            const screen = document.querySelector('.screen');
            const val = document.querySelector('.val');
            const expr = document.querySelector('.expr');
            const keys = document.querySelectorAll('.key');
            const keysGrid = document.querySelector('.keys');
            
            // 가로가 매우 긴 경우 처리
            if (width > height * 1.5) {
                // 계산기를 세로 중심으로 제한
                calc.style.maxWidth = `${height * 0.7}px`;
                calc.style.height = '100%';
                calc.style.maxHeight = '100%';
            } else {
                calc.style.maxWidth = 'min(400px, 100vh)';
                calc.style.maxHeight = 'min(600px, 100vh)';
            }
            
            // 높이에 따른 동적 조절
            if (height < 300) {
                calc.style.padding = '2px';
                calc.style.gap = '2px';
                screen.style.flex = '0 0 35px';
                screen.style.padding = '5px 10px';
                val.style.fontSize = '14px';
                val.style.height = '20px';
                expr.style.fontSize = '9px';
                expr.style.height = '12px';
                keysGrid.style.gap = '2px';
                keys.forEach(k => {
                    k.style.fontSize = '11px';
                    k.style.borderRadius = '4px';
                });
            } else if (height < 400) {
                calc.style.padding = '3px';
                calc.style.gap = '3px';
                screen.style.flex = '0 0 45px';
                screen.style.padding = '8px 12px';
                val.style.fontSize = '18px';
                val.style.height = '25px';
                expr.style.fontSize = '10px';
                expr.style.height = '15px';
                keysGrid.style.gap = '3px';
                keys.forEach(k => {
                    k.style.fontSize = '13px';
                    k.style.borderRadius = '6px';
                });
            } else if (height < 500) {
                calc.style.padding = '5px';
                calc.style.gap = '5px';
                screen.style.flex = '0 0 60px';
                screen.style.padding = '10px 15px';
                val.style.fontSize = '24px';
                val.style.height = '30px';
                expr.style.fontSize = '12px';
                expr.style.height = '20px';
                keysGrid.style.gap = '5px';
                keys.forEach(k => {
                    k.style.fontSize = '16px';
                    k.style.borderRadius = '8px';
                });
            } else {
                // 기본값 복원
                calc.style.padding = '10px';
                calc.style.gap = '10px';
                screen.style.flex = '0 0 80px';
                screen.style.padding = '15px 20px';
                val.style.fontSize = '32px';
                val.style.height = '40px';
                expr.style.fontSize = '14px';
                expr.style.height = '25px';
                keysGrid.style.gap = '8px';
                keys.forEach(k => {
                    k.style.fontSize = '20px';
                    k.style.borderRadius = '10px';
                });
            }
            
            // 너비에 따른 추가 조절
            if (width < 250) {
                calc.style.padding = '2px';
                keysGrid.style.gap = '2px';
                keys.forEach(k => k.style.fontSize = '12px');
            }
        }

        // 초기 실행 및 리사이즈 이벤트
        adjustSize();
        window.addEventListener('resize', adjustSize);
        window.addEventListener('orientationchange', adjustSize);
        
        // ResizeObserver로 더 정확한 감지
        if (window.ResizeObserver) {
            const resizeObserver = new ResizeObserver(() => {
                adjustSize();
            });
            resizeObserver.observe(document.body);
            resizeObserver.observe(document.querySelector('.calc'));
        }
        
        // iframe 내부 로드 감지
        if (window.self !== window.top) {
            // 여러 번 시도하여 확실히 조정
            [10, 50, 100, 200, 500, 1000].forEach(delay => {
                setTimeout(adjustSize, delay);
            });
        }
        
        // 페이지 완전 로드 후 재조정
        window.addEventListener('load', () => {
            adjustSize();
            setTimeout(adjustSize, 100);
        });
    </script>
</body>
</html>